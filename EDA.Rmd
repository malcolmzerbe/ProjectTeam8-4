---
title: "Stat 184 Project"
author: "ProjectTeam8-4"
date: "May 3, 2021"
output: html_notebook 
---

#### Load Packages
```{r message=FALSE}
library(tidyverse) 
```

#### Read in Data and Convert Stat files to data frames
```{r}
Memfan <- read.csv("Memorial_Fantasy.csv", header = T)
Pgafan <- read.csv("PGA_Fantasy.csv", header = T)
Schfan <- read.csv("Schwab_Fantasy.csv", header = T)
Memstat<- read.delim("Memorial_Stats.txt", header = T )
Memstats <-  as.data.frame(matrix(Memstat$Data, ncol=9, byrow=TRUE))
Pgastat<- read.delim("PGA_Stats.txt", header = T)
Pgastats <-  as.data.frame(matrix(Pgastat$Data, ncol=9, byrow=TRUE))
Schstat<- read.delim("Schwab_Stats.txt", header = T)
Schstats <-  as.data.frame(matrix(Schstat$Data, ncol=9, byrow=TRUE))
```

#### Join Fantasy and Statistics to Create One Data Frame for Each of Three Tournaments

```{r}
Memorial <- Memstats %>%
  inner_join(Memfan, by=c("V2"= "Name"))
Pga <- Pgastats %>%
  inner_join(Pgafan, by=c("V2"= "Name")) 
Schwab <- Schstats %>%
  inner_join(Schfan, by=c("V2"= "Name"))
```

#### Combine the Three Tournament Data Frames to Final Data Frame
Include paragraph explaining what the R statements are "doing" and what you are trying to accomplish with these statements.

```{r}
All <- rbind(Memorial, Pga, Schwab)
names(All)[1:9] <- c('Position', 'Player', 'Score', 
                          'Putt', 'ARG', 'App', 'OTT', 'T2G', 'Total')
All$Score <- fct_recode(All$Score, "0" = "E") 
Top10 <- 
  All %>%
  group_by(Tournament) %>%
  mutate(Score = as.numeric(as.character(factor(Score)))) %>%
  mutate(rank = rank(Score, ties.method = "min")) %>%
  mutate(top10 = if_else(rank <= 10, 'Yes', 'No')) %>%
  mutate(MadeCut = if_else(Position =='CUT', 'No', 'Yes')) %>%
  mutate(SalaryRange = ifelse(grepl("^6", Salary), "6000s",
                       ifelse(grepl("^7", Salary), "7000s",
                       ifelse(grepl("^8", Salary), "8000s",
                       ifelse(grepl("^9" , Salary), "9000s",
                       ifelse(grepl("^10", Salary), "10000s", "11000s"))))))
TournPlayed <- All %>%
  select((Player)) %>%
  group_by(Player) %>%
  mutate(tournplayed = n()) %>%
  distinct()
AvgScore <- All %>%
    select(Player, Score, Tournament) %>%
    mutate(Score = as.numeric(as.character(factor(Score)))) %>%
    spread(Tournament, Score) %>%
    mutate(avg = round(rowMeans(.[2:4], na.rm=TRUE), 1))
Results_Player <- Top10 %>%
  left_join(TournPlayed, by = "Player")
AllResults <- Results_Player %>%
  left_join(AvgScore, by = "Player")
```


#### Research Question 1
Based on whether or not a player made the cut, is there a correlation between a players rank and the amount of fantasy points earned? 

To answer this question we used a scatter plot to determine if there is a correlation between rank and fantasy points. Our graph shows that for players who made the cut, there is a strong positive correlation between a player's rank and earning more fantasy points. For players that did not make the cut there is a positive correlation between their rank and the amount of fantasy points they acquire. What these graph show is that players with higher ranks tend to earn more fantasy points. The highest ranked players (those in the top 10) earn significantly more fantasy points than those players in the middle of the pack. These graphs also suggest that players earn more fantasy points in the Charles Schwab and PGA Championship compared to the Memorial tournament. 
```{r}
Graph2 <-
  AllResults%>%
  mutate(MadeCut = recode(MadeCut, "Yes" = "Made Cut: Yes", "No"= "Made Cut: No"))

ggplot(Graph2)+
  aes(x = rank, y = FPTS, colour = Tournament)+
  geom_point(size=1L)+
  xlab("Rank")+
  ylab("Fantasy Points (FPTS)")+
  scale_x_reverse() +
  scale_color_hue() +
  theme_bw() +
  facet_wrap(vars(MadeCut))
```

#### Research Question 2
What is the relationship in each tournament between the average scores of the players who were in the top 10 and not in the top 10 ?

To answer this question we chose to use a box plot. These graphs showed us that players not in the top ten had roughly the same average score in all three tournaments. Players who made the top 10 had more spread between the three tournaments in regards to average score. These graphs also show us that players in the top 10 had their best scores in the Charles Schwab Tournament, followed by the PGA Championship, then the Memorial Tournament. The PGA Championship had the most outliers in the positive direction so this suggests that more players played a worse round of golf than usual at the PGA ChAmpionship. The three graphs showed that there is a distinct difference between the average scores of golfers in the top 10 and those not in the top 10. The graphs also showed that both top 10 and not top 10 golfers hit about the score not matter what course they play on. 

```{r}
ggplot(AllResults)+
  aes(x = top10, y = avg, fill = Tournament)+
  geom_boxplot()+
  xlab("Top10")+
  ylab("Average Scores")+
  scale_fill_hue()+
  theme_bw()+
  facet_wrap(vars(Tournament))
```
